{"version":3,"file":"index.js","names":["CanceledError","_Error","_inherits2","_super","_createSuper","_this","_classCallCheck2","call","name","_createClass2","_wrapNativeSuper2","Error","Delay","lastInvocationDone","wait","_this2","_defineProperty2","delay","Promise","resolve","timeout","setTimeout","ready","then","key","value","flush","clearTimeout","cancel","canceled","handler","_this3","throttle","fn","_wait","options","arguments","length","undefined","Number","isFinite","Math","max","getNextArgs","prev","next","nextArgs","nextInvocation","invoke","args","result","_asyncToGenerator2","_regenerator","mark","_callee","wrap","_callee$","_context","apply","_toConsumableArray2","abrupt","sent","stop","wrapper","_len","Array","_key","_callee2","prevLastInvocationDone","_callee2$","_context2","_callee3","_callee3$","_context3","_default","exports","module","default"],"sources":["src/index.js"],"sourcesContent":["// @flow\n\nclass CanceledError extends Error {\n  constructor() {\n    super('throttled invocation was canceled')\n    this.name = 'CanceledError'\n  }\n}\n\nclass Delay {\n  ready: Promise<void>\n  resolve: () => void\n  canceled: boolean = false\n  timeout: TimeoutID\n\n  constructor(lastInvocationDone: Promise<any>, wait: number) {\n    const delay = new Promise((resolve: () => void) => {\n      this.timeout = setTimeout(resolve, wait)\n      this.resolve = resolve\n    })\n    this.ready = lastInvocationDone.then(\n      () => delay,\n      () => delay\n    )\n  }\n\n  flush() {\n    clearTimeout(this.timeout)\n    this.resolve()\n  }\n\n  cancel() {\n    this.canceled = true\n    clearTimeout(this.timeout)\n    this.resolve()\n  }\n\n  then<T>(handler: () => Promise<T>): Promise<T> {\n    return this.ready.then((): Promise<T> => {\n      if (this.canceled) throw new CanceledError()\n      return handler()\n    })\n  }\n}\n\nfunction throttle<Args: Array<any>, Value>(\n  fn: (...args: Args) => Value | Promise<Value>,\n  _wait: ?number,\n  options: {\n    getNextArgs?: (args0: Args, args1: Args) => Args,\n  } = {}\n): {\n  (...args: Args): Promise<Value>,\n  cancel: () => Promise<void>,\n  flush: () => Promise<void>,\n} {\n  const wait = _wait != null && Number.isFinite(_wait) ? Math.max(_wait, 0) : 0\n  const getNextArgs = options.getNextArgs || ((prev, next) => next)\n\n  let nextArgs: ?Args\n  let lastInvocationDone: Promise<any> = Promise.resolve()\n  let delay: Delay = new Delay(lastInvocationDone, 0)\n  let nextInvocation: ?Promise<Value> = null\n\n  function invoke(): Promise<Value> {\n    const args = nextArgs\n    // istanbul ignore next\n    if (!args) throw new Error('unexpected error: nextArgs is null')\n    nextInvocation = null\n    nextArgs = null\n    const result = (async () => await fn(...args))()\n    lastInvocationDone = result.catch(() => {})\n    delay = new Delay(lastInvocationDone, wait)\n    return result\n  }\n\n  function wrapper(...args: Args): Promise<Value> {\n    nextArgs = nextArgs ? getNextArgs(nextArgs, args) : args\n    if (!nextArgs) throw new Error('unexpected error: nextArgs is null')\n    if (!nextInvocation) nextInvocation = delay.then(invoke)\n    return nextInvocation\n  }\n\n  wrapper.cancel = async (): Promise<void> => {\n    const prevLastInvocationDone = lastInvocationDone\n    delay.cancel()\n    nextInvocation = null\n    nextArgs = null\n    lastInvocationDone = Promise.resolve()\n    delay = new Delay(lastInvocationDone, 0)\n    await prevLastInvocationDone\n  }\n\n  wrapper.flush = async (): Promise<void> => {\n    delay.flush()\n    await lastInvocationDone\n  }\n\n  return wrapper\n}\n;(throttle: any).CanceledError = CanceledError\n\nexport default ((throttle: any): {\n  <Args: Array<any>, Value>(\n    fn: (...args: Args) => Promise<Value>,\n    wait: ?number,\n    options?: {\n      getNextArgs?: (args0: Args, args1: Args) => Args,\n    }\n  ): {\n    (...args: Args): Promise<Value>,\n    cancel: () => Promise<void>,\n    flush: () => Promise<void>,\n  },\n  CanceledError: typeof CanceledError,\n})\n"],"mappings":";;;;;;;;;;;;;;;;;;;IAEMA,aAAa,0BAAAC,MAAA;EAAA,IAAAC,UAAA,aAAAF,aAAA,EAAAC,MAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAJ,aAAA;EACjB,SAAAA,cAAA,EAAc;IAAA,IAAAK,KAAA;IAAA,IAAAC,gBAAA,mBAAAN,aAAA;IACZK,KAAA,GAAAF,MAAA,CAAAI,IAAA,OAAM,mCAAmC;IACzCF,KAAA,CAAKG,IAAI,GAAG,eAAe;IAAA,OAAAH,KAAA;EAC7B;EAAC,WAAAI,aAAA,aAAAT,aAAA;AAAA,oBAAAU,iBAAA,aAJyBC,KAAK;AAAA,IAO3BC,KAAK;EAMT,SAAAA,MAAYC,kBAAgC,EAAEC,IAAY,EAAE;IAAA,IAAAC,MAAA;IAAA,IAAAT,gBAAA,mBAAAM,KAAA;IAAA,IAAAI,gBAAA,+BAHxC,KAAK;IAIvB,IAAMC,KAAK,GAAG,IAAIC,OAAO,CAAC,UAACC,OAAmB,EAAK;MACjDJ,MAAI,CAACK,OAAO,GAAGC,UAAU,CAACF,OAAO,EAAEL,IAAI,CAAC;MACxCC,MAAI,CAACI,OAAO,GAAGA,OAAO;IACxB,CAAC,CAAC;IACF,IAAI,CAACG,KAAK,GAAGT,kBAAkB,CAACU,IAAI,CAClC;MAAA,OAAMN,KAAK;IAAA,GACX;MAAA,OAAMA,KAAK;IAAA,CACb,CAAC;EACH;EAAC,IAAAR,aAAA,aAAAG,KAAA;IAAAY,GAAA;IAAAC,KAAA,EAED,SAAAC,MAAA,EAAQ;MACNC,YAAY,CAAC,IAAI,CAACP,OAAO,CAAC;MAC1B,IAAI,CAACD,OAAO,CAAC,CAAC;IAChB;EAAC;IAAAK,GAAA;IAAAC,KAAA,EAED,SAAAG,OAAA,EAAS;MACP,IAAI,CAACC,QAAQ,GAAG,IAAI;MACpBF,YAAY,CAAC,IAAI,CAACP,OAAO,CAAC;MAC1B,IAAI,CAACD,OAAO,CAAC,CAAC;IAChB;EAAC;IAAAK,GAAA;IAAAC,KAAA,EAED,SAAAF,KAAQO,OAAyB,EAAc;MAAA,IAAAC,MAAA;MAC7C,OAAO,IAAI,CAACT,KAAK,CAACC,IAAI,CAAC,YAAkB;QACvC,IAAIQ,MAAI,CAACF,QAAQ,EAAE,MAAM,IAAI7B,aAAa,CAAC,CAAC;QAC5C,OAAO8B,OAAO,CAAC,CAAC;MAClB,CAAC,CAAC;IACJ;EAAC;EAAA,OAAAlB,KAAA;AAAA;AAGH,SAASoB,QAAQA,CACfC,EAA6C,EAC7CC,KAAc,EAQd;EAAA,IAPAC,OAEC,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAMN,IAAMtB,IAAI,GAAGoB,KAAK,IAAI,IAAI,IAAIK,MAAM,CAACC,QAAQ,CAACN,KAAK,CAAC,GAAGO,IAAI,CAACC,GAAG,CAACR,KAAK,EAAE,CAAC,CAAC,GAAG,CAAC;EAC7E,IAAMS,WAAW,GAAGR,OAAO,CAACQ,WAAW,IAAK,UAACC,IAAI,EAAEC,IAAI;IAAA,OAAKA,IAAI;EAAA,CAAC;EAEjE,IAAIC,QAAe;EACnB,IAAIjC,kBAAgC,GAAGK,OAAO,CAACC,OAAO,CAAC,CAAC;EACxD,IAAIF,KAAY,GAAG,IAAIL,KAAK,CAACC,kBAAkB,EAAE,CAAC,CAAC;EACnD,IAAIkC,cAA+B,GAAG,IAAI;EAE1C,SAASC,MAAMA,CAAA,EAAmB;IAChC,IAAMC,IAAI,GAAGH,QAAQ;IACrB;IACA,IAAI,CAACG,IAAI,EAAE,MAAM,IAAItC,KAAK,CAAC,oCAAoC,CAAC;IAChEoC,cAAc,GAAG,IAAI;IACrBD,QAAQ,GAAG,IAAI;IACf,IAAMI,MAAM,GAAG,IAAAC,kBAAA,2BAAAC,YAAA,YAAAC,IAAA,CAAC,SAAAC,QAAA;MAAA,OAAAF,YAAA,YAAAG,IAAA,UAAAC,SAAAC,QAAA;QAAA;UAAA,QAAAA,QAAA,CAAAb,IAAA,GAAAa,QAAA,CAAAZ,IAAA;YAAA;cAAAY,QAAA,CAAAZ,IAAA;cAAA,OAAkBZ,EAAE,CAAAyB,KAAA,aAAAC,mBAAA,aAAIV,IAAI,EAAC;YAAA;cAAA,OAAAQ,QAAA,CAAAG,MAAA,WAAAH,QAAA,CAAAI,IAAA;YAAA;YAAA;cAAA,OAAAJ,QAAA,CAAAK,IAAA;UAAA;QAAA;MAAA,GAAAR,OAAA;IAAA,IAAE,CAAC;IAChDzC,kBAAkB,GAAGqC,MAAM,SAAM,CAAC,YAAM,CAAC,CAAC,CAAC;IAC3CjC,KAAK,GAAG,IAAIL,KAAK,CAACC,kBAAkB,EAAEC,IAAI,CAAC;IAC3C,OAAOoC,MAAM;EACf;EAEA,SAASa,OAAOA,CAAA,EAAgC;IAAA,SAAAC,IAAA,GAAA5B,SAAA,CAAAC,MAAA,EAA5BY,IAAI,OAAAgB,KAAA,CAAAD,IAAA,GAAAE,IAAA,MAAAA,IAAA,GAAAF,IAAA,EAAAE,IAAA;MAAJjB,IAAI,CAAAiB,IAAA,IAAA9B,SAAA,CAAA8B,IAAA;IAAA;IACtBpB,QAAQ,GAAGA,QAAQ,GAAGH,WAAW,CAACG,QAAQ,EAAEG,IAAI,CAAC,GAAGA,IAAI;IACxD,IAAI,CAACH,QAAQ,EAAE,MAAM,IAAInC,KAAK,CAAC,oCAAoC,CAAC;IACpE,IAAI,CAACoC,cAAc,EAAEA,cAAc,GAAG9B,KAAK,CAACM,IAAI,CAACyB,MAAM,CAAC;IACxD,OAAOD,cAAc;EACvB;EAEAgB,OAAO,CAACnC,MAAM,oBAAAuB,kBAAA,2BAAAC,YAAA,YAAAC,IAAA,CAAG,SAAAc,SAAA;IAAA,IAAAC,sBAAA;IAAA,OAAAhB,YAAA,YAAAG,IAAA,UAAAc,UAAAC,SAAA;MAAA;QAAA,QAAAA,SAAA,CAAA1B,IAAA,GAAA0B,SAAA,CAAAzB,IAAA;UAAA;YACTuB,sBAAsB,GAAGvD,kBAAkB;YACjDI,KAAK,CAACW,MAAM,CAAC,CAAC;YACdmB,cAAc,GAAG,IAAI;YACrBD,QAAQ,GAAG,IAAI;YACfjC,kBAAkB,GAAGK,OAAO,CAACC,OAAO,CAAC,CAAC;YACtCF,KAAK,GAAG,IAAIL,KAAK,CAACC,kBAAkB,EAAE,CAAC,CAAC;YAAAyD,SAAA,CAAAzB,IAAA;YAAA,OAClCuB,sBAAsB;UAAA;UAAA;YAAA,OAAAE,SAAA,CAAAR,IAAA;QAAA;MAAA;IAAA,GAAAK,QAAA;EAAA,CAC7B;EAEDJ,OAAO,CAACrC,KAAK,oBAAAyB,kBAAA,2BAAAC,YAAA,YAAAC,IAAA,CAAG,SAAAkB,SAAA;IAAA,OAAAnB,YAAA,YAAAG,IAAA,UAAAiB,UAAAC,SAAA;MAAA;QAAA,QAAAA,SAAA,CAAA7B,IAAA,GAAA6B,SAAA,CAAA5B,IAAA;UAAA;YACd5B,KAAK,CAACS,KAAK,CAAC,CAAC;YAAA+C,SAAA,CAAA5B,IAAA;YAAA,OACPhC,kBAAkB;UAAA;UAAA;YAAA,OAAA4D,SAAA,CAAAX,IAAA;QAAA;MAAA;IAAA,GAAAS,QAAA;EAAA,CACzB;EAED,OAAOR,OAAO;AAChB;AACA;AAAE/B,QAAQ,CAAOhC,aAAa,GAAGA,aAAa;AAAA,IAAA0E,QAAA,GAE7B1C,QAAQ;AAAA2C,OAAA,cAAAD,QAAA;AAAAE,MAAA,CAAAD,OAAA,GAAAA,OAAA,CAAAE,OAAA"}
